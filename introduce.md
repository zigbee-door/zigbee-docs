# 总体概述

## 门锁

产用四节干电池供电的基于Zigbee无线通讯的门锁,主要由一个基于射频模块的增强型51单片机CC2530,EEPROM(存储芯片),时间芯片,RFID读卡器以及H桥电机组成.门锁需要实现的功能包括离线程序和线上程序. 离线程序主要包括刷卡授权删权,开关门,低电量报警等. 线上程序主要包括向基站(基站又把数据发送给电脑)传送电池电量,用户刷卡记录,用户授权信息等等. 论文中在门锁的设计中需要突出的亮点是如何做到低功耗设计. 需要注意的是在门锁系统中门锁相当于Zigbee路由协议中的终端设备.

## 基站

基站是Zigbee路由协议中的协调器(这里我把基站的功能弱化了,它只是用来传输门锁信息的中转站),基站和门锁通过Zigbee协议(无线传输)通信,基站和上位机电脑通过TCP协议通信. 基站在实际的应用中有很多个,门锁的数量更多.

## Zibee路由协议(需要自行设计算法)

基站和门锁之间本身是并不知道谁应该和谁通信(有很多的基站和门锁,毕竟Zigbee传输距离有限,但是一幢大楼的门禁需要很多门锁和基站, 尤其是酒店). 所以需要设计一个算法,该算法可以自动让门锁去匹配离它最近并且在可以传输信息距离的范围内的基站(基站和门锁如果距离太大,传输信号过弱,可能导致通信失误).


## 上位机(电脑)

电脑是实现对门锁和基站进行监控的操作设备. 电脑通过交换机连接基站(基站有很多), 基于Nodejs特性比较好,所以产用Nodejs编写TCP通信利用Socket和基站连接,由于Nodejs是单线程,所以会产用守护进程的方式进行, 和基站通信产生的任务命令放入Redis缓存(这一步不知道效果会怎么样), 然后是开一个Express服务, 实时接收Redis缓存池的数据,并将其发送到浏览器端进行数据显示, 如果浏览器要发送命令,Express服务端则存入Redis, Tcp通信程序实时接收需要发送的命令进行发送.

这里我把Tcp通信程序和Express服务分开设计,它们之间通过Redis通信.


## 最终实现路线

浏览器 <---> Express服务 <---> Redis <---> Tcp服务 <---> 基站 <---> 门锁

- 总通信协议(该通信协议从Express一直走到门锁)
 
除了Tcp和基站之间的tcp通信协议以及基站和门锁之间的zigbee通信协议, 我还需要在它们上面封装一层自己的通信协议, 该通信协议用于识别发送的是什么命令,接收的是什么数据等等.

## 论文中需要突出的重点

 - 门锁低功耗设计
 - zigbee自行设计的路由协议
 - 总体设计的框架实现模式(通信由门锁主动发起,向上寻求PC命令,该设计主要是为了低功耗,门锁是1s钟唤醒一次,平常处于休眠状态,从上往下容易在它休眠时失去信号)
 - Nodejs(比较新颖)

- 论文中需要体现的图表数据(浏览器端实现展示)
 - 信号强度和距离的关系对比图
 - 低功耗设计的一些数据(电机随电池电量变化的占空比变化)
 - 门锁的信号强度变化
 - 电池电量的走势(长期监视的过程)
 - 基站门锁列表的实时监督(zibee路由算法实现的最终数据)
 - 从上往下发送命令的时延数据
 - ...